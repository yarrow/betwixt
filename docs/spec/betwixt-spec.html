<!DOCTYPE html>

<html>
<head>
  <title>betwixt-spec.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>betwixt-spec.coffee</h1>
        

        
      </div>

      
        
        
        
          <div class='highlight'><pre>path = <span class="hljs-built_in">require</span> <span class="hljs-string">"path"</span>
Betwixt = <span class="hljs-built_in">require</span> path.join <span class="hljs-string">".."</span>, <span class="hljs-string">"lib"</span>, <span class="hljs-string">"betwixt"</span>
<span class="hljs-built_in">require</span> <span class="hljs-string">"jasmine-given"</span></pre></div>
        
      
        
        <p>Jasmine-Given tries to execute the expressions in a failing comparison, but
since it hasn’t required Betwixt, the result of Betwixt.foo(…) is
<code>[Error: ReferenceError: Betwixt is not defined]</code>. Jasmine-Given <em>can</em> find
instance variables, however, so we just say <code>@Betwixt = Betwixt</code></p>
<p>Similarly, J-G needs the variables in expressions to be instance variables</p>

        
          <div class='highlight'><pre>describe <span class="hljs-string">"Betwixt"</span>, <span class="hljs-function">-&gt;</span>
  zero = <span class="hljs-string">"\u0000"</span>               <span class="hljs-comment"># for use by expect()</span>
  Given -&gt; <span class="hljs-property">@Betwixt</span> = Betwixt
  Given -&gt; <span class="hljs-property">@zero</span> = <span class="hljs-string">"\u0000"</span>     <span class="hljs-comment"># for use by Then -&gt;</span></pre></div>
        
      
        
        <h2 id="creation-and-description-methods">Creation and description methods</h2>

        
      
        
        
        
          <div class='highlight'><pre>  describe <span class="hljs-string">"trim"</span>, <span class="hljs-function">-&gt;</span>
    it <span class="hljs-string">"should trim trailing zeros"</span>, <span class="hljs-function">-&gt;</span>
      expect(Betwixt.trim <span class="hljs-string">"\uaaaa\u0000"</span>).toEqual(<span class="hljs-string">"\uaaaa"</span>)
      expect(Betwixt.trim <span class="hljs-string">"\u0000"</span>).toEqual(<span class="hljs-string">""</span>)

  describe <span class="hljs-string">"validated"</span>, <span class="hljs-function">-&gt;</span>
    nonempty = <span class="hljs-string">"\uaaaa\u0000"</span>
    it <span class="hljs-string">"should return the same value as trim for nonempty strings"</span>, <span class="hljs-function">-&gt;</span>
      expect(Betwixt.validated nonempty).toEqual Betwixt.trim nonempty
    it <span class="hljs-string">"should throw an error if its parameter is zero/empty"</span>, <span class="hljs-function">-&gt;</span>
      expect(<span class="hljs-function">-&gt;</span> Betwixt.validated zero).toThrowError(Error)
      expect(<span class="hljs-function">-&gt;</span> Betwixt.validated <span class="hljs-string">""</span>).toThrowError(Error)

  describe <span class="hljs-string">"midpoint"</span>, <span class="hljs-function">-&gt;</span>
    Given -&gt; <span class="hljs-property">@m</span> = <span class="hljs-property">@Betwixt</span>.midpoint()
    Then -&gt; <span class="hljs-property">@m</span> == <span class="hljs-string">"\u8000"</span>

  describe <span class="hljs-string">"toHex"</span>, <span class="hljs-function">-&gt;</span>
    Then -&gt; <span class="hljs-property">@Betwixt</span>.toHex(<span class="hljs-string">"\uBEAD\ucafe"</span>) == <span class="hljs-string">"beadcafe"</span></pre></div>
        
      
        
        <h2 id="the-before-and-after-methods">The before and after methods</h2>

        
      
        
        
        
          <div class='highlight'><pre>  describe <span class="hljs-string">"before and after"</span>, <span class="hljs-function">-&gt;</span>
    Given -&gt; <span class="hljs-property">@start</span> = <span class="hljs-string">"\u1234"</span>
    Given -&gt; <span class="hljs-property">@extra</span> = <span class="hljs-string">"\ufade\ucafe"</span>
    Given -&gt; <span class="hljs-property">@ffff</span> = <span class="hljs-string">"\uffff"</span>

    describe <span class="hljs-string">"They trim their arguments"</span>, <span class="hljs-function">-&gt;</span>
      Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@start</span>+<span class="hljs-property">@zero</span>) == <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@start</span>)
      Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@ffff</span>+<span class="hljs-property">@zero</span>) == <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@ffff</span>)
      Then -&gt; <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@ffff</span>+<span class="hljs-property">@zero</span>) == <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@ffff</span>)
      Then -&gt; <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@zero</span>) == <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-string">""</span>)

    describe <span class="hljs-string">"before"</span>, <span class="hljs-function">-&gt;</span>
      Given -&gt; <span class="hljs-property">@decrement</span> = <span class="hljs-string">"\u1233"</span>
      it <span class="hljs-string">"should throw an error if its parameter is zero/empty"</span>, <span class="hljs-function">-&gt;</span>
        expect(<span class="hljs-function">-&gt;</span> Betwixt.before zero).toThrowError(Error)
        expect(<span class="hljs-function">-&gt;</span> Betwixt.before <span class="hljs-string">""</span>).toThrowError(Error)
      describe <span class="hljs-string">"before treats the first non-zero character code as an integer
          and decrements it"</span>, <span class="hljs-function">-&gt;</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@start</span>) == <span class="hljs-property">@decrement</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@zero</span>+<span class="hljs-property">@start</span>) == <span class="hljs-property">@zero</span>+<span class="hljs-property">@decrement</span>
      describe <span class="hljs-string">"before throws away anything after the decremented character"</span>, <span class="hljs-function">-&gt;</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@start</span>+<span class="hljs-property">@extra</span>) == <span class="hljs-property">@decrement</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@zero</span>+<span class="hljs-property">@start</span>+<span class="hljs-property">@extra</span>) == <span class="hljs-property">@zero</span>+<span class="hljs-property">@decrement</span>
      describe <span class="hljs-string">"if the decrement of the character is @zero, then before appends
          @Betwixt.midpoint() to the string"</span>, <span class="hljs-function">-&gt;</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-string">"\u0001"</span>) == <span class="hljs-property">@zero</span>+<span class="hljs-property">@Betwixt</span>.midpoint()
        Then -&gt; <span class="hljs-property">@Betwixt</span>.before(<span class="hljs-property">@zero</span>+<span class="hljs-string">"\u0001"</span>) == <span class="hljs-property">@zero</span>+<span class="hljs-property">@zero</span>+<span class="hljs-property">@Betwixt</span>.midpoint()

    describe <span class="hljs-string">"after"</span>, <span class="hljs-function">-&gt;</span>
      Given -&gt; <span class="hljs-property">@increment</span> = <span class="hljs-string">"\u1235"</span>
      describe <span class="hljs-string">"before treats the first non-0xffff character code as an integer
          and decrements it"</span>, <span class="hljs-function">-&gt;</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@start</span>) == <span class="hljs-property">@increment</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@ffff</span>+<span class="hljs-property">@start</span>) == <span class="hljs-property">@ffff</span>+<span class="hljs-property">@increment</span>
      describe <span class="hljs-string">"after throws away anything after the incremented character"</span>, <span class="hljs-function">-&gt;</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@start</span>+<span class="hljs-property">@extra</span>) == <span class="hljs-property">@increment</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@ffff</span>+<span class="hljs-property">@start</span>+<span class="hljs-property">@extra</span>) == <span class="hljs-property">@ffff</span>+<span class="hljs-property">@increment</span>
      describe <span class="hljs-string">"When the entire string consists of 0xffff characters, after
          appends a 0x8000 character to the string"</span>, <span class="hljs-function">-&gt;</span>
        Then  -&gt; <span class="hljs-property">@Betwixt</span>.after(<span class="hljs-property">@ffff</span>+<span class="hljs-property">@ffff</span>) == <span class="hljs-property">@ffff</span>+<span class="hljs-property">@ffff</span>+<span class="hljs-string">"\u8000"</span></pre></div>
        
      
        
        <h2 id="the-between-method">The between method</h2>

        
      
        
        
        
          <div class='highlight'><pre>  describe <span class="hljs-string">"between()"</span>, <span class="hljs-function">-&gt;</span>
    Given -&gt; <span class="hljs-property">@a</span> = <span class="hljs-string">"\u2001"</span>
    Given -&gt; <span class="hljs-property">@b</span> = <span class="hljs-string">"\u2002"</span>
    Given -&gt; <span class="hljs-property">@c</span> = <span class="hljs-string">"\u2003"</span></pre></div>
        
      
        
        <p><strong>The easy parts</strong></p>

        
          <div class='highlight'><pre>    describe <span class="hljs-string">"between trims its arguments"</span>, <span class="hljs-function">-&gt;</span>
      Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@zero</span>, <span class="hljs-property">@zero</span>+<span class="hljs-property">@zero</span>) == <span class="hljs-string">""</span>
    describe <span class="hljs-string">"Betwixt.between(x,x) returns x"</span>, <span class="hljs-function">-&gt;</span>
      Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@a</span>,<span class="hljs-property">@a</span>) == <span class="hljs-property">@a</span>
    describe <span class="hljs-string">"when possible, the fractions are averaged"</span>, <span class="hljs-function">-&gt;</span>
      Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@a</span>,<span class="hljs-property">@c</span>) == <span class="hljs-property">@b</span>
      Then -&gt; <span class="hljs-property">@a</span> &lt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@a</span>, <span class="hljs-property">@c</span>) &lt; <span class="hljs-property">@c</span>
    describe <span class="hljs-string">"the order of operands doesn't matter"</span>, <span class="hljs-function">-&gt;</span>
      Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@b</span>, <span class="hljs-property">@a</span>) == <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@a</span>, <span class="hljs-property">@b</span>)
      Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@c</span>, <span class="hljs-property">@a</span>) == <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@a</span>, <span class="hljs-property">@c</span>)
    describe <span class="hljs-string">"slightly less easy parts"</span>, <span class="hljs-function">-&gt;</span>
      Given -&gt; <span class="hljs-property">@aa</span> = <span class="hljs-property">@a</span>+<span class="hljs-string">"\u3333"</span>
      Given -&gt; <span class="hljs-property">@cc</span> = <span class="hljs-property">@c</span>+<span class="hljs-string">"\uffff"</span>
      describe <span class="hljs-string">"If the two characters that first differ can be averaged,
          anything after them is ignored"</span>, <span class="hljs-function">-&gt;</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@aa</span>, <span class="hljs-property">@cc</span>) == <span class="hljs-property">@b</span>
      describe <span class="hljs-string">"Strings with leading identical characters do the work after the
          leading characters"</span>, <span class="hljs-function">-&gt;</span>
        Given -&gt; <span class="hljs-property">@prefix</span> = <span class="hljs-string">"\uaaaa\ubbbb\ucccc"</span>
        Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@prefix</span>+<span class="hljs-property">@aa</span>, <span class="hljs-property">@prefix</span>+<span class="hljs-property">@cc</span>) ==
                                               <span class="hljs-property">@prefix</span>+<span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@aa</span>, <span class="hljs-property">@cc</span>)</pre></div>
        
      
        
        <p><strong>The hard parts</strong></p>

        
          <div class='highlight'><pre>    describe <span class="hljs-string">"When the strings are the same length and their last characters
        differ only by one, the result is the prefix of the lesser string,
        extended by Betwixt.midpoint()"</span>, <span class="hljs-function">-&gt;</span>
      Then -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@a</span>, <span class="hljs-property">@b</span>) == <span class="hljs-string">"\u2001\u8000"</span>
      Then -&gt; <span class="hljs-property">@a</span> &lt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@a</span>, <span class="hljs-property">@b</span>) &lt; <span class="hljs-property">@b</span>
    describe <span class="hljs-string">"When the first differing characters differ only by one, and the
        greater string t has more characters, the result is the prefix of
        of t up to and including the first differing character"</span>, <span class="hljs-function">-&gt;</span>
      Given -&gt; <span class="hljs-property">@lo</span> = <span class="hljs-string">"\uaaaa\u1234"</span>
      Given -&gt; <span class="hljs-property">@hi</span> = <span class="hljs-string">"\uaaaa\u1235\ubbb0"</span>
      Then  -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@hi</span>, <span class="hljs-property">@lo</span>) == <span class="hljs-string">"\uaaaa\u1235"</span>
    describe <span class="hljs-string">"When the lesser string s has more characters than the greater,
        consider the first differing character c, and the next character d.
        The between method returns the prefix of s up to and including c,
        concatenated with a character midway between d and 2**16."</span>, <span class="hljs-function">-&gt;</span>
      Given -&gt; <span class="hljs-property">@lo</span> = <span class="hljs-string">"\uaaaa\u1234\ubbbb\u9999"</span>
      Given -&gt; <span class="hljs-property">@hi</span> = <span class="hljs-string">"\uaaaa\u1235"</span>
      Then  -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@lo</span>, <span class="hljs-property">@hi</span>) == <span class="hljs-string">"\uaaaa\u1234\udddd"</span>
    describe <span class="hljs-string">"But if character d is 0xffff (2**16-1), then we can't find a
      character between it and 2**16. So we need to extend our prefix to
      include c and the longest sequence of 0xffff characters immediately
      following c. Then d is the character after all of those."</span>, <span class="hljs-function">-&gt;</span>
      Given -&gt; <span class="hljs-property">@lo</span> = <span class="hljs-string">"\uaaaa\u1234\uffff\uffff\ubbbb\u9999"</span>
      Given -&gt; <span class="hljs-property">@hi</span> = <span class="hljs-string">"\uaaaa\u1235"</span>
      Then  -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@lo</span>, <span class="hljs-property">@hi</span>) == <span class="hljs-string">"\uaaaa\u1234\uffff\uffff\udddd"</span>
    describe <span class="hljs-string">"Furthermore, if *every* character after c is 0xffff, then
        we append 0x8000 to s itself."</span>, <span class="hljs-function">-&gt;</span>
      Given -&gt; <span class="hljs-property">@lo</span> = <span class="hljs-string">"\uaaaa\u1234\uffff\uffff"</span>
      Given -&gt; <span class="hljs-property">@hi</span> = <span class="hljs-string">"\uaaaa\u1235"</span>
      Then  -&gt; <span class="hljs-property">@Betwixt</span>.between(<span class="hljs-property">@hi</span>, <span class="hljs-property">@lo</span>) == <span class="hljs-string">"\uaaaa\u1234\uffff\uffff\u8000"</span></pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
